<!DOCTYPE html>
<html>
   <head>
       <meta name="viewport" content="width=device-width, initial-scale=1">
       <title>Hackathon 2015</title>
       <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
       <script type="text/javascript" src="http://studs.gpsgate.com/Services/Core.ashx?xss2=true&deps=true"></script>
       <script type="text/javascript" src="geolocation.js"></script>
       <script>
            goog.require('GpsGate.Server'); 
            goog.require('jQuery'); 
            // jQuery etc...
       </script>
       
       <script>
            GpsGate.require('GpsGate.Server.Hackathon');
            // other services
       </script>
        
       <script type="text/javascript">
        
            app = function() {
                this.username = 'team5';
                this.password = 'foo';
            };
                        
            app.prototype.getUsersInTag = function(tag) {               
                return GpsGate.Server.Hackathon.GetUsersInTag(tag).addCallbacks(
                    function(result) {
                        // Do something with the result
                    },
                    function(err) {
                        // An error occured
                        console.error(err);
                    }
                );
            };
            
            function start(){
                var button = jQuery("#send_button");
                button.hide();
                var myApp = new app();          
                myApp.getUsersInTag('TeamA Tag');
                navigator.geolocation.getCurrentPosition(function (position) {
                  button.show();
                  button.click(function (event) {
                    event.preventDefault;
                    var name = jQuery("#name").val() + "_" + jQuery("#familyname").val();
                    name = name.toLowerCase();
                    var patt = /[^a-z0-9]/g;
                    name = name.replace(patt,"");
                    name = name.substring(0,15);

                    var loc = jQuery("#location").val();
                    loc = loc.toLowerCase();
                    var patt = /[^a-z0-9]/g;
                    loc = loc.replace(patt,"");
                    loc = loc.substring(0,15);
                    // console.log(name);
                    GpsGate.Server.Hackathon.ReportPosition(name, "foo", loc, "T5", position.coords.longitude, position.coords.latitude);
                    window.location.href = "view.html?tag=T5";
                  });
                  // console.log(position);

                });
            };

            jQuery(document).ready(start);
            
       </script>
   </head>
   <body>
    <div class="container">
      <form method="view.html">
        <div class="form-group">
          <input id="name" type="text" class="form-control" name="input" placeholder="What's your first name?">
          <input id="familyname" type="text" class="form-control" name="input" placeholder="What's your family name?">
          <input id="location" type="text" class="form-control" name="input" placeholder="Where you at?">
          <button id="send_button" type="button" class="btn btn-default"> Send </button>
        </div
      </form>
    </div>
   </body>
</html>
